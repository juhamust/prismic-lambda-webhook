---
service: prismic-lambda-webhook

plugins:
  - serverless-plugin-optimize

package:
  individually: true

provider:
  name: aws
  runtime: nodejs6.10
  stage: dev
  region: eu-central-1
  profile: ${opt:profile,env:AWS_PROFILE}
  environment: ${file(./env.yml)}
  memorySize: 512
  iamRoleStatements:
    - Effect: Allow
      Action:
        - sns:ListTopics
        - sns:CreateTopic
        - sns:Publish
        - sns:Subscribe
      Resource:
        - arn:aws:sns:${self:provider.region}:*:PRISMIC_LAMBDA_WEBHOOK

functions:
  webhook:
    description: Handle Prismic.io webhook post and send SNS notification
    handler: functions/webhook.handle
    events:
      - http: POST webhook

  # EXAMPLE handler
  sns:
    description: Handle SNS event generated by webhook handler
    handler: functions/sns.handle
    events:
      - sns: PRISMIC_LAMBDA_WEBHOOK
